# echo milestones plan

Goal: build a fast IP lookup REST API service for Vercel and Railway. API-only, no UI. IP data is downloaded at build/deploy time (not committed). Strict TDD, Bun + TypeScript, UT coverage >= 95%, lint 0 warnings/errors. Each milestone is deployable and verifiable.

## Milestone 1: project skeleton + quality gates (deployable)

Scope:
- Initialize Bun + TypeScript project structure.
- Add Hono server entry and health endpoint.
- Add lint configuration with zero warnings policy.
- Add test runner (bun test) with coverage gate >= 95%.
- Add Husky hooks: pre-commit runs UT, pre-push runs UT + lint.
- Add README updates and docs baseline.

Deliverables:
- `src/` with minimal server and route skeleton.
- `tests/` with initial UT for health endpoint (TDD).
- `package.json` scripts for dev/test/lint/coverage.
- `docs/` updated with this plan.

Verification:
- `bun test` passes locally.
- `bun run lint` passes with 0 warnings/errors.
- Server starts and health endpoint returns 200.

Deployment:
- Basic build that can deploy (no IP data yet).

Progress:
- [x] Completed

## Milestone 2: IP data fetch pipeline + runtime wiring (deployable)

Scope:
- Add `scripts/ipdb-fetch.ts` to download v4/v6 xdb into `data/`.
- Add `.gitignore` entry for `data/`.
- Add runtime loader with in-memory cache and 1h TTL.
- Ensure Node.js runtime for Vercel.
- Provide clear local dev instructions and error messages when data missing.

Deliverables:
- `data/` generated by script, not committed.
- `src/services/ipdb.ts` with loader/cache.
- `docs/` updates for local dev and data source.

Verification:
- `bun run ipdb:fetch` downloads both xdb files.
- API server starts and can load data without crash.

Deployment:
- Build steps can download data during CI/deploy.

Progress:
- [ ] Not started

## Milestone 3: IP parsing + lookup API (deployable)

Scope:
- Implement IP extraction from headers (`x-forwarded-for`, `x-real-ip`).
- Normalize IPv6-mapped IPv4.
- Select v4/v6 xdb based on IP type.
- Lookup and return structured location fields.
- Include attribution, source, latency.

Deliverables:
- `GET /api/ip` endpoint implemented.
- `src/utils/ip.ts` for parsing.
- `src/services/ipLookup.ts` for query logic.
- UT coverage for IP parsing, lookup success/failure, response shape.

Verification:
- `bun test` with >=95% coverage.
- Response matches API contract.

Deployment:
- API endpoint works on Vercel and Railway.

Progress:
- [ ] Not started

## Milestone 4: Docker + deployment docs (deployable)

Scope:
- Add Dockerfile for Railway deployment.
- Ensure build stage downloads xdb and runtime reads from `data/`.
- Add deployment notes for Vercel and Railway.

Deliverables:
- `Dockerfile` and related docs.
- README updates with deployment steps.

Verification:
- Build image locally and run container with API responding.

Deployment:
- Railway deploy using Docker.

Progress:
- [ ] Not started

## Milestone 5: hardening + polish (deployable)

Scope:
- Add structured error responses.
- Add small performance notes and metrics.
- Update docs for attribution and data licensing.

Deliverables:
- Stable API contract.
- Docs completed.

Verification:
- UT coverage remains >=95%.
- Lint stays clean.

Deployment:
- Release-ready state.

Progress:
- [ ] Not started
